@using Models.EnumClasses
@using Models.StaticData
@model IEnumerable<Models.ViewModels.CourseIndexVM>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Index</h1>

<p>

    <a asp-action="Create">Create New</a>
</p>
<a asp-action="print" class="btn btn-success" target="_blank"> Print Report</a>

<div class="row">
    <div class="col-7">

        <form asp-action="index">
            <div class="form-group col-5">
                <label class="control-label">برنامج</label>
                <input name="Name" class="form-control" value="@ViewBag.Search.Name" />
            </div>
            <div class="form-group col-5">
                <label class="control-label">تاريخ البداية</label>
                <input name="BeginningDate" class="form-control" type="date" value="@(ViewBag.Search?.BeginningDate != null ? ((DateOnly)ViewBag.Search.BeginningDate).ToString("yyyy-MM-dd") : "")" />
            </div>
            <div class="form-group col-5">
                <label class="control-label">تاريخ النهاية</label>
                <input name="EndingDate" class="form-control" type="date" value="@(ViewBag.Search?.EndingDate != null ? ((DateOnly)ViewBag.Search.EndingDate).ToString("yyyy-MM-dd") : "")" />
            </div>
            <div class="form-group col-5">
                <label name="ImplementationPlace" class="control-label">مكان التنفيذ </label>
            <input name="ImplementationPlace" value="@ViewBag.Search.ImplementationPlace" class="form-control" />
            </div>
            <div class="form-group col-5">
                <label name="ImplementedCenter" class="control-label">مركز التنفيذ</label>
            <input name="ImplementedCenter" value="@ViewBag.Search.ImplementedCenter" class="form-control" />
            </div>
            <div class="form-group col-5">
                <label name="ImplementationTypeId" class="control-label">نوع التنفيذ</label>
                    <select class="form-select" name="ImplementationTypeId">
                    @{
                        if ( ViewBag.Search.ImplementationTypeId == null)
                        {
                            <option value="" selected>غير محدد</option>
                        }
                        else
                        {
                            <option value="">غير محدد</option>
                        }
                        foreach (var item in ViewBag.ImplementationType)
                        {
                            if (ViewBag.Search.ImplementationTypeId == item.Id)
                            {
                                <option value="@item.Id" selected>@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.Id">@item.Name</option>
                            }

                        }
                    }
                    </select>
            </div>
            <div class="form-group col-5">
                <label name="TotalImplementationId" class="control-label">اجمالي التنفيذ</label>
                <select class="form-select" name="TotalImplementationId">
                    @{
                        if (ViewBag.Search.TotalImplementationId == null)
                        {
                            <option value="" selected>غير محدد</option>
                        }
                        else
                        {
                            <option value="">غير محدد</option>
                        }
                        foreach (var item in ViewBag.TotalImplementation)
                        {
                            if (ViewBag.Search.TotalImplementationId == item.Id)
                            {
                                <option value="@item.Id" selected>@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.Id">@item.Name</option>
                            }

                        }
                    }
                </select>
            </div>
            <div class="form-group col-5">
                <label name="Check" class="control-label">حالة البرنامج</label>
                <select class="form-select" name="Check">
                    @{

                        if (ViewBag.Search.Check == null)
                        {
                            <option value="" selected>غير محدد</option>
                        }
                        else
                        {
                            <option value="">غير محدد</option>
                        }
                        foreach (var item in ViewBag.Check)
                        {
                            if (ViewBag.Search.Check == item.Key)
                            {
                                <option value="@item.Key" selected>@item.Value</option>
                            }
                            else
                            {
                                <option value="@item.Key">@item.Value</option>
                            }

                        }
                    }
                </select>
            </div>
            <div class="form-group col-5 ">
                <label name="CourseNatureId" class="control-label">طبيعة الدورة</label>
                <select class="form-select" name="CourseNatureId">
                    @{
                        if (ViewBag.Search.CourseNatureId == null)
                        {
                            <option value="" selected>غير محدد</option>
                        }
                        else
                        {
                            <option value="">غير محدد</option>
                        }
                        foreach (var item in ViewBag.CourseNature)
                        {
                            if (ViewBag.Search.CourseNatureId == item.Id)
                            {
                                <option value="@item.Id" selected>@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.Id">@item.Name</option>
                            }

                        }
                    }
                </select>
            </div>
               <div class="form-group col-5">
                <label class="control-label">المدرب</label>
                <input name="Instructor" class="form-control" value="@ViewBag.Search.Instructor" />
            </div>
            <div class="form-check form-switch col-3">
                @{
                   
                    if (ViewBag.Search.Sort)
                    {
                        <input class="form-check-input" name="Sort" value="true" checked type="checkbox">
                    }
                    else
                    {
                        <input class="form-check-input" name="Sort" value="true" type="checkbox">
                    }
                }
                <label class="form-check-label" for="Sort">ترتيب تنازلي</label>
            </div>
            <input type="submit" value="search" class="btn btn-primary" />
        </form>
        <div class="col-2">
            <a type="button" asp-action="index" class="btn btn-danger "> reset</a>
        </div>
    </div>
</div>
<div >
    <table class="table table-striped table-bordered text-nowrap">
        <thead class="bg-primary text-white" style="background-color:#5D7B9D  ">
            <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.TargetSector)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Participants)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ImplementationPlace)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DaysCount)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ImplementedDays)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.BeginningDate)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.EndingDate)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.TraineesNumber)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Cost)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ImplementedCenter)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.HoursNumber)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ImplementationTypeName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.TotalImplementationName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RoomNumber)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Material)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CourseType)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Rating)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ImplementationMonth)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ActualCost)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Code)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Check)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.PdfFile)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Link)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RatingSpecialist)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.TraineesRating)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CourseNatureName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.TrainingSpecialistName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.EnterName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FirstInstructorName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SecondInstructorName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ThirdInstructorName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ForthInstructorName)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TargetSector)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Participants)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ImplementationPlace)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DaysCount)
                </td>
                <td >
                    @Html.DisplayFor(modelItem => item.ImplementedDays)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.BeginningDate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.EndingDate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TraineesNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Cost)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ImplementedCenter)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.HoursNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ImplementationTypeName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TotalImplementationName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.RoomNumber)
                </td>
                <td>
                    @(item.Material.HasValue ? StaticData.material[item.Material.Value] : "")
                </td>
                <td>
                    @{
                        if (item.CourseType.HasValue)
                        {

                            @StaticData.courseType[item.CourseType.Value]
                        }

                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Rating)
                </td>
                <td>
                    @{
                        if (item.ImplementationMonth.HasValue)
                        {

                            @StaticData.implementationMonth[item.ImplementationMonth.Value]
                        }

                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ActualCost)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Code)
                </td>
                <td>
                    @{
                        if (item.Check.HasValue)
                        {

                            @StaticData.check[item.Check.Value]
                        }

                    }
                </td>
                <td>
                    @{
                        if (item.PdfFile != null)
                        {

                            <a href="@Url.Action("DownloadFile", "course", new { fileName = item.PdfFile })" class="btn btn-primary">
                                <i class="bi bi-download"></i>
                            </a>
                        }
                    }
                </td>
                <td>
                    <a href="@item.Link" target="_blank">@item.Link </a>
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.RatingSpecialist)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TraineesRating)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CourseNatureName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TrainingSpecialistName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.EnterName)
                </td>
                <td>
                    @item.FirstInstructorName
                </td>
                <td>
                    @item.SecondInstructorName
                </td>
                <td>
                    @item.ThirdInstructorName
                </td>
                <td>
                    @item.ForthInstructorName
                </td>
                <td >
                    <a asp-action="Edit" asp-route-id="@item.Id" type="button" class="btn btn-dark">Edit</a>
                    <a asp-action="Details" asp-route-id="@item.Id" type="button" class="btn btn-info ">Details</a>
                    <a asp-action="Course" asp-route-id="@item.Id" asp-controller="trainee" type="button" class="btn btn-primary ">المتدربين</a>
                    <a asp-action="index" asp-route-id="@item.Id" asp-controller="CourseInstructor" type="button" class="btn btn-success ">المدربين</a>
                    <button type="button" class="btn btn-danger " data-bs-toggle="modal" data-bs-target="#deleteModal" data-courseid="@item.Id">
                        Delete
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>
</div>
<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this course ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="post" action="/manage/course/delete/">
                    <input type="hidden" name="id" id="courseIdInput" value="" />
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    var deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var id = button.getAttribute('data-courseid');
        var input = document.getElementById('courseIdInput');
        input.value = id;
    });
</script>
